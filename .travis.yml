sudo: required
dist: trusty
language: python
python:
  - "2.7"
  - "3.3"
  - "3.4"
  - "3.5"
  - "nightly"
before_install:
  - chmod u+x ./tests/tests.sh
  - ./tests/tests.sh
  - chmod u+x ./lets-encrypt_acme_renew_script/server_setup.sh
  - sudo ./lets-encrypt_acme_renew_script/server_setup.sh
install:
  - pip install -r tests/requirements.txt
script:
#  - export TRAVIS_DOMAIN=$(grep -Eoi "hostname:[A-za-z0-9]+.ngrok.io" url.log| head -1 | cut -d ":" -f2)
#  - coverage run --source ./ --omit ./tests/server.py -m unittest tests
   - su -s /bin/bash -c 'export TRAVIS_DOMAIN=$(grep -Eoi "hostname:[A-za-z0-9]+.ngrok.io" url.log| head -1 | cut -d ":" -f2) && coverage run --source ./ --omit ./tests/server.py -m unittest tests' acme
after_success:
  - coveralls
